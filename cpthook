#!/usr/bin/env python

import re


# Supported hooks - see
# https://www.kernel.org/pub/software/scm/git/docs/githooks.html
supported_hooks = [
    'applypatch-msg',
    'pre-applypatch',
    'post-applypatch',
    'pre-commit',
    'prepare-commit-msg',
    'commit-msg',
    'post-commit',
    'pre-rebase',
    'post-checkout',
    'post-merge',
    'pre-receive',
    'update',
    'post-receive',
    'post-update',
    'pre-auto-gc',
    'post-rewrite',
]


def parse_config(filename):
    from ConfigParser import SafeConfigParser
    parser = SafeConfigParser()
    parser.read(filename)

    # Record the groups as defined in the config
    repos = {}
    hooks = {}

    for section in parser.sections():
        if section.startswith('repos\s+'):
            repo_group = re.sub('^repos\s+', '', section)
            repos[repo_group] = {}
            try:
                members = section.get(section, 'members')
                repos[repo_group]['members'] = members
            except ConfigParser.NoOptionError:
                # No members
                pass
        elif section.startswith('hooks\s+'):
            repo_group = re.sub('^repos\s+', '', section)
            repos[repo_group] = {}
            pass
        else:
            pass
